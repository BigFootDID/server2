<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    {% if session.is_admin %}
    <h2>ğŸ”§ ê´€ë¦¬ì íŒ¨ë„</h2>
    <ul class="list-group mb-4">
      <li class="list-group-item">
        <button class="btn btn-sm btn-outline-secondary me-2" onclick="loadSubmissions()">
          ì œì¶œ ëª©ë¡
        </button>
        <button class="btn btn-sm btn-outline-danger me-2" onclick="clearSubmissions()">
          ëª©ë¡ ì´ˆê¸°í™”
        </button>
        <a href="/admin/download_bulk_submit" class="btn btn-sm btn-outline-primary">
          bulk_submit.txt ë‹¤ìš´ë¡œë“œ
        </a>
      </li>
      <li class="list-group-item">
        <a href="/admin/download_all" class="btn btn-sm btn-outline-success">
          ì „ì²´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ (ZIP)
        </a>
      </li>
      <li class="list-group-item">
        <label for="zipUpload" class="form-label">ì „ì²´ ë°ì´í„° ì—…ë¡œë“œ (ZIP)</label>
        <input type="file" id="zipUpload" accept=".zip" class="form-control">
        <button class="btn btn-sm btn-outline-dark mt-2" onclick="uploadAllZip()">
          ZIP ì—…ë¡œë“œ
        </button>
      </li>
    </ul>

    <div class="mb-3">
      <label>ë¬¸ì œ ë²ˆí˜¸</label>
      <input id="codePid" class="form-control d-inline-block w-auto" placeholder="0058">
      <button class="btn btn-sm btn-primary ms-2" onclick="loadCode()">
        ì½”ë“œ ë³´ê¸°
      </button>
    </div>
    <pre id="codeResult" class="border p-3 bg-white" style="height:200px;overflow:auto;"></pre>
    <hr>

    <!-- ì´í•˜ ìƒëµ, ê¸°ì¡´ê³¼ ë™ì¼ -->

  {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    async function loadSubmissions(){
      const res = await fetch('/admin/download_bulk_submit',{credentials:'same-origin'});
      if(!res.ok){ alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'); return; }
      const txt = await res.text();
      const ids = [];
      // ê° ë¸”ë¡ì˜ PIDë§Œ ìˆ˜ì§‘
      const regex = /^([0-9]{4})~/gm;
      let match;
      while((match = regex.exec(txt)) !== null) ids.push(match[1]);
      document.getElementById('codeResult').textContent = ids.join(', ');
    }

    async function loadCode(){
      const pid = document.getElementById('codePid').value.trim();
      if(!pid) return;
      const res = await fetch('/admin/download_bulk_submit',{credentials:'same-origin'});
      if(!res.ok){ alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'); return; }
      const txt = await res.text();
      // PID~<newline> ... until newline~ ë¸”ë¡ ì¶”ì¶œ
      const pattern = new RegExp(pid + '~\r?\n([\s\S]*?)(?=\r?\n~)', 'm');
      const m = txt.match(pattern);
      document.getElementById('codeResult').textContent = m ? m[1] : 'ì½”ë“œ ì—†ìŒ';
    }

    async function clearSubmissions(){
      if(!confirm('ëª©ë¡ ì´ˆê¸°í™”?')) return;
      const res = await fetch('/admin/clear',{method:'POST',credentials:'same-origin'});
      alert(res.ok ? 'ì´ˆê¸°í™” ì™„ë£Œ' : 'ì´ˆê¸°í™” ì‹¤íŒ¨');
    }

    // ê¸°íƒ€ í•¨ìˆ˜ ìƒëµ
  </script>
</body>
</html>
